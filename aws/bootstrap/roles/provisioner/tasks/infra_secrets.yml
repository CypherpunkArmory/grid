---
- name: Set basic Infra Secrets
  environment:
    VAULT_TOKEN: "{{ vault_token }}"
  when: "'infra' not in secrets_list"
  block:
    - name: Generate a json file full of secrets
      template:
        src: templates/infra_secrets.j2.json
        dest: /root/infra_secrets.json
        owner: root

    - name: Put DD Api Key
      command: "vault kv put secret/infra @/root/infra_secrets.json"

    - name: Remove the file
      file:
        path: /root/infra_secrets.json
        state: absent
