{
  "variables": {
    "version": "0.0.0",
    "template": "lb"
  },
  "builders": [{
      "type": "virtualbox-ovf",
      "source_path": "../ubuntu-base.ova",
      "format": "ova",
      "ssh_username": "ubuntu",
      "ssh_private_key_file": "../provision",
      "http_directory": "http",
      "vm_name": "lb-{{user `version`}}",
      "boot_wait": "1s",
      "boot_command": [
        "<esc><esc><esc><esc><esc><esc><esc><esc><esc><esc><esc><esc>",
        "/vmlinuz ",
        "console=ttyS0 ",
        "rw root=/dev/sda1 ",
        "initrd=/initrd.img ",
        "ds=nocloud-net;s=http://{{ .HTTPIP }}:{{ .HTTPPort }}/",
        "<enter>"
      ],
      "guest_additions_mode": "disable",
      "export_opts": [
        "--vsys", "0",
        "--description", "Load Balancer Host",
        "--version", "{{user `version`}}"
      ],
      "headless": true
    }
  ],
  "provisioners": [
    {
      "type": "shell-local",
      "command": "ansible-playbook --private-key ../provision --user ubuntu -i ../inventory lb.yml"
    },
    {
      "type": "shell-local",
      "command": "sleep 5"
    }
  ],
  "post-processors": [
    {
      "type": "vagrant",
      "vagrantfile_template": "../tasks/templates/Vagrantfile.template",
      "output": "{{user `template`}}_v{{user `version`}}.box"
    }
  ]
}
